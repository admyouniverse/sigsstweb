(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{164:function(t,a,e){"use strict";function r(t,a,e,r,o,s,i,n){var p,l="function"==typeof t?t.options:t;if(a&&(l.render=a,l.staticRenderFns=e,l._compiled=!0),r&&(l.functional=!0),s&&(l._scopeId="data-v-"+s),i?(p=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},l._ssrRegister=p):o&&(p=n?function(){o.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:o),p)if(l.functional){l._injectStyles=p;var c=l.render;l.render=function(t,a){return p.call(a),c(t,a)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,p):[p]}return{exports:t,options:l}}e.d(a,"a",(function(){return r}))},224:function(t,a,e){var r=e(353);"string"==typeof r&&(r=[[t.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};e(133)(r,o);r.locals&&(t.exports=r.locals)},352:function(t,a,e){"use strict";e(224)},353:function(t,a,e){(t.exports=e(132)(!1)).push([t.i,".box-sig .box-header[data-v-960f0772] {\n  background-color: #59AF50;\n  color: #fff;\n}\n.box-sig .box-body[data-v-960f0772] {\n  background-color: #e8fce8;\n}",""])},98:function(t,a,e){"use strict";e.r(a);var r={props:["editar","ppradb","empresadb"],data:function(){return{ppra:{idPpra:0,empresasContrato:[],versao:"",dataHora:"",status:"ELABORAÇÃO",liberado:"LIBERADO",tipoPpra:"SELECIONE",atividadeLocal:"",introducao:"",objetivos:"",metodos:"",orientacoes:"",comentarios:"",caminhoPdf:"",ppra:""},matrizes:[],carregando:!0,mensagem:"Carregando...",html:'<i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>',contratosAll:[],contratos:[],empresas:[],empresa:"",contrato:{empresa:{},empresaContratante:{}},adicionar:!1,montou:!1,file:"",aba:""}},computed:{parametro:function(){var t=window.location.search.substring(1),a=new URLSearchParams(t);return a.get("aba")?a.get("aba"):"detalhes"}},methods:{abrirUpload:function(){$("#file").click()},handleFileUpload:function(){this.file=this.$refs.file.files[0],this.submitFile()},submitFile:function(){var t=new FormData;t.append("file",this.file);var a=this;axios.post("http://200.98.201.236:8081/upload-file",t,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){console.log("SUCCESS!!"),a.ppra.caminhoPdf=t.data.data.new_file_name,a.salvar()})).catch((function(){console.log("FAILURE!!")}))},status:function(t){return"ELABORAÇÃO"==t?"<strong style='color: red'>Em Elaboração</strong>":"Completo"},situacao:function(t){return"LIBERADO"==t?"<strong style='color: red'>Liberado</strong>":"Congelado"},tipoPcmso:function(t){return"EMISSÃO"==t?"Emissão":"REVISÃO_PARCIAL"==t?"Revisão Parcial":"REVISÃO_GERAL"==t?"Revisão Geral":void 0},carregar:function(t){this.mensagem=t,this.html='<i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>',this.carregando=!0},sucesso:function(t){this.mensagem=t,this.html='<i class="fa fa-check-circle fa-2x fa-fw"></i>';var a=this;setTimeout((function(){a.carregando=!1}),800)},alerta:function(t){this.mensagem=t,this.html='<i class="fa fa-close fa-2x fa-fw"></i>';var a=this;setTimeout((function(){a.carregando=!1}),5e3)},adicionarContrato:function(){this.ppra.empresasContrato.push(this.contrato),this.contrato={empresa:{},empresaContratante:{}},this.adicionar=!1},excluirContrato:function(t){this.ppra.empresasContrato.splice(t,1)},contratosEmContratos:function(t){for(var a=0;a<this.ppra.empresasContrato.length;a++)if(this.ppra.empresasContrato[a].idEmpresaContrato===t.idEmpresaContrato)return!0;return!1},valida:function(t){var a=this;if(this.editar)t();else{if(!a.contrato||""==a.ppra.dataHora||"SELECIONE"==a.ppra.tipoPpra)return!1;a.carregar("Validando..."),axios.get("/gro/list/"+a.contrato.idEmpresaContrato).then((function(e){if(e.data){if(console.log(e.data),"EMISSÃO"==e.data.tipoPpra&&"EMISSÃO"==a.ppra.tipoPpra)return a.alerta("O tipo não pode ser emissão!"),a.ppra.tipoPpra="SELECIONE",a.ppra.versao="",!1;if("CONGELADO"!=e.data.liberado)return a.alerta("O PPRA anterior, com este contrato, precisa ter a situação CONGELADO. Corrija."),!1;var r=new Date(e.data.dataHora);if(r>=new Date(a.ppra.dataHora))return a.alerta("Data precisa ser maior que "+(r.getDate()+1)+"/"+(r.getMonth()+1)+"/"+r.getFullYear()),!1;console.log("Chegou aqui!"),a.ppra.introducao=e.data.introducao,a.ppra.objetivos=e.data.objetivos,a.ppra.comentarios=e.data.comentarios,t()}else t()}))}},mudaData:function(){var t=this;t.carregar("Buscando contratos para esta data..."),this.contratos=this.contratosAll.filter((function(a){var e=new Date(a.dataIni),r=new Date(t.ppra.dataHora);return e<=r&&(!a.dataFim||new Date(a.dataFim)>=r)})),this.sucesso("Contratos recuperados.")},getVersao:function(){var t=this;this.valida((function(){axios.post("/gro/versao",{contrato:t.contrato,data:t.ppra.dataHora,tipo:t.ppra.tipoPpra}).then((function(a){console.log(a),"Erro"==a.data?(t.alerta("Verifique o tipo de PPRA!"),t.ppra.versao=""):(t.sucesso("Versão recuperada."),t.ppra.versao=a.data)}))}))},getContratos:function(t){var a=this;a.mensagem="Carregando contratos das empresas...",a.carregando=!0,axios.get("/gro/contratos/"+this.empresa.idEmpresa).then((function(e){a.contratosAll=e.data,a.contratos=a.contratosAll,a.carregando=!1,(t||Function)()}))},salvar:function(){var t=this;this.valida((function(){t.mensagem="Salvando PPRA...",t.carregando=!0,axios.post("/gro",{ppra:t.ppra,contrato:t.contrato}).then((function(a){"erro"!=a.data?window.location.href="/gro/editar/"+a.data+"/?aba="+t.aba:(t.mensagem="Erro!",t.carregando=!1)}))}))}},mounted:function(){var t=this;console.log(this.empresadb),this.aba=this.parametro,console.log("parametro",this.parametro),axios.get("/matriz/list").then((function(a){t.matrizes=a.data})),axios.get("/empresas/list").then((function(a){t.empresas=a.data,t.carregando=!1,t.montou=!0})),this.editar?(this.ppra=this.ppradb,this.empresa=this.ppra.empresasContrato[0].empresa,this.getContratos(),this.contrato=this.ppra.empresasContrato[0],console.log(this.contrato)):(this.empresa=this.empresadb,this.getContratos((function(){"NENHUM"!=t.empresa.tipoEmpresa&&"CONTRATANTE"!=t.empresa.tipoEmpresa||t.contratos.forEach((function(a){console.log(a),a.empresaContratante.idEmpresa==t.empresa.idEmpresa&&(t.contrato=a)}))})))}},o=(e(352),e(164)),s=Object(o.a)(r,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("section",{staticClass:"content"},[t.carregando?e("BlockUI",{attrs:{message:t.mensagem,html:t.html}}):t._e(),t._v(" "),e("div",[e("b-card",{staticClass:"sig",attrs:{"no-body":""}},[e("b-tabs",{attrs:{card:""}},[e("b-tab",{attrs:{title:"Detalhes",active:"capa"!=t.parametro},on:{click:function(a){t.aba="detalhes"}}},[e("b-card-text",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-1"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("ID")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.ppra.idPpra,expression:"ppra.idPpra"}],staticClass:"form-control",attrs:{type:"text",disabled:""},domProps:{value:t.ppra.idPpra},on:{input:function(a){a.target.composing||t.$set(t.ppra,"idPpra",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Empresa")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.empresa.razaoSocial,expression:"empresa.razaoSocial"}],staticClass:"form-control",attrs:{type:"text",disabled:""},domProps:{value:t.empresa.razaoSocial},on:{input:function(a){a.target.composing||t.$set(t.empresa,"razaoSocial",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Unidade")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.empresa.nomeUnidade,expression:"empresa.nomeUnidade"}],staticClass:"form-control",attrs:{type:"text",disabled:""},domProps:{value:t.empresa.nomeUnidade},on:{input:function(a){a.target.composing||t.$set(t.empresa,"nomeUnidade",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Data")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.ppra.dataHora,expression:"ppra.dataHora"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:t.ppra.dataHora},on:{blur:t.mudaData,input:function(a){a.target.composing||t.$set(t.ppra,"dataHora",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Estabelecimento")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.contrato,expression:"contrato"}],staticClass:"form-control",attrs:{disabled:"NENHUM"==t.empresa.tipoEmpresa||"CONTRATANTE"==t.empresa.tipoEmpresa},on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.contrato=a.target.multiple?e:e[0]},t.getVersao]}},[t._l(t.contratos,(function(a){return a.empresaContratante.idEmpresa!=t.empresa.idEmpresa?e("option",{domProps:{value:a}},[t._v("\n                                            "+t._s(a.idEmpresaContrato)+" |\n                                            "+t._s(a.empresaContratante.nomeFantasia))]):t._e()})),t._v(" "),t._l(t.contratos,(function(a){return a.empresaContratante.idEmpresa==t.empresa.idEmpresa?e("option",{domProps:{value:a}},[t._v("\n                                            "+t._s(a.empresaContratante.nomeFantasia)+"\n                                        ")]):t._e()}))],2)])]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Tipo")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.ppra.tipoPpra,expression:"ppra.tipoPpra"}],staticClass:"form-control",on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.ppra,"tipoPpra",a.target.multiple?e:e[0])},t.getVersao]}},[e("option",{attrs:{value:"SELECIONE",disabled:""}},[t._v("--- Selecione ---")]),t._v(" "),e("option",{attrs:{value:"EMISSÃO"}},[t._v("Emissão")]),t._v(" "),e("option",{attrs:{value:"REVISÃO_PARCIAL"}},[t._v("Revisão Parcial")]),t._v(" "),e("option",{attrs:{value:"REVISÃO_GERAL"}},[t._v("Revisão Geral")])])])]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Versão")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.ppra.versao,expression:"ppra.versao"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.ppra.versao},on:{input:function(a){a.target.composing||t.$set(t.ppra,"versao",a.target.value)}}})])]),t._v(" "),e("div",{staticClass:"col-md-3"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Matriz de Risco")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.ppra.matrizRisco,expression:"ppra.matrizRisco"}],staticClass:"form-control",on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.ppra,"matrizRisco",a.target.multiple?e:e[0])}}},t._l(t.matrizes,(function(a){return e("option",{domProps:{value:a}},[t._v(t._s(a.descricao))])})),0)])]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Status")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.ppra.status,expression:"ppra.status"}],staticClass:"form-control",on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.ppra,"status",a.target.multiple?e:e[0])}}},[e("option",{attrs:{value:"SELECIONE",disabled:""}},[t._v("--- Selecione ---")]),t._v(" "),e("option",{attrs:{value:"ELABORAÇÃO"}},[t._v("Elaboração")]),t._v(" "),e("option",{attrs:{value:"COMPLETO"}},[t._v("Completo")])])])]),t._v(" "),e("div",{staticClass:"col-md-2"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:""}},[t._v("Situação")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.ppra.liberado,expression:"ppra.liberado"}],staticClass:"form-control",on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.ppra,"liberado",a.target.multiple?e:e[0])}}},[e("option",{attrs:{value:"SELECIONE"}},[t._v("SELECIONE")]),t._v(" "),e("option",{attrs:{value:"LIBERADO"}},[t._v("Liberado")]),t._v(" "),"COMPLETO"==t.ppra.status?e("option",{attrs:{value:"CONGELADO"}},[t._v("Congelado\n                                        ")]):t._e()])])])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12"},[t.ppra.idPpra&&!t.ppra.caminhoPdf?e("button",{staticClass:"btn pull-right btn-success",on:{click:t.abrirUpload}},[e("i",{staticClass:"fa fa-upload"}),t._v(" Inserir PDF")]):t._e(),t._v(" "),t.ppra.idPpra&&t.ppra.caminhoPdf?e("button",{staticClass:"btn pull-right btn-success ml-3",on:{click:t.abrirUpload}},[e("i",{staticClass:"fa fa-upload"}),t._v(" Atualizar PDF")]):t._e(),t._v(" "),t.ppra.idPpra&&t.ppra.caminhoPdf?e("a",{staticClass:"btn pull-right btn-success",attrs:{target:"_blank",href:"http://200.98.201.236:8081/"+t.ppra.caminhoPdf}},[e("i",{staticClass:"fas fa-eye"}),t._v(" Visualizar PDF")]):t._e(),t._v(" "),e("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file",id:"file"},on:{change:function(a){return t.handleFileUpload()}}}),t._v(" "),e("button",{staticClass:"btn btn-success",on:{click:function(a){return t.salvar()}}},[e("i",{staticClass:"fas fa-save"}),t._v("\n                                    Salvar")])])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 mt-3 text-center"},[e("h5",{staticClass:"bg-success p-3 text-light"},[t._v("PCMSO vinculado(s)")])]),t._v(" "),e("div",{staticClass:"col-md-12"},[e("table",{staticClass:"table table-hover table-striped"},[e("tbody",[e("tr",[e("th",[t._v("\n                                                Versão\n                                            ")]),t._v(" "),e("th",[t._v("Tipo PCMSO")]),t._v(" "),e("th",[t._v("\n                                                Data\n                                            ")]),t._v(" "),e("th",[t._v("Status")]),t._v(" "),e("th",[t._v("Situação")])]),t._v(" "),t._l(t.ppra.pcmsos,(function(a){return e("tr",[e("td",[t._v(t._s(a.versao))]),t._v(" "),e("td",[t._v(t._s(t.tipoPcmso(a.tipoPcmso)))]),t._v(" "),e("td",[t._v(t._s(t._f("moment")(a.dataHora,"DD/MM/YYYY")))]),t._v(" "),e("td",{domProps:{innerHTML:t._s(t.status(a.status))}}),t._v(" "),e("td",{domProps:{innerHTML:t._s(t.situacao(a.liberado))}})])}))],2)])])])])],1),t._v(" "),e("b-tab",{attrs:{title:"Capas",active:"capa"==t.parametro},on:{click:function(a){t.aba="capa"}}},[e("b-card-text",{staticClass:"sig"},[e("b-tabs",{attrs:{pills:""}},[e("b-tab",{attrs:{title:"Introdução"}},[e("b-card-text",[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.ppra.introducao,expression:"ppra.introducao"}],staticClass:"form-control mt-4",attrs:{rows:"12"},domProps:{value:t.ppra.introducao},on:{input:function(a){a.target.composing||t.$set(t.ppra,"introducao",a.target.value)}}})])],1),t._v(" "),e("b-tab",{attrs:{title:"Objetivo"}},[e("b-card-text",[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.ppra.objetivos,expression:"ppra.objetivos"}],staticClass:"form-control mt-4",attrs:{rows:"12"},domProps:{value:t.ppra.objetivos},on:{input:function(a){a.target.composing||t.$set(t.ppra,"objetivos",a.target.value)}}})])],1),t._v(" "),e("b-tab",{attrs:{title:"Orientação"}},[e("b-card-text",[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.ppra.orientacoes,expression:"ppra.orientacoes"}],staticClass:"form-control mt-4",attrs:{rows:"12"},domProps:{value:t.ppra.orientacoes},on:{input:function(a){a.target.composing||t.$set(t.ppra,"orientacoes",a.target.value)}}})])],1),t._v(" "),e("b-tab",{attrs:{title:"Atividades"}},[e("b-card-text",[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.empresa.descricaoAtividade,expression:"empresa.descricaoAtividade"}],staticClass:"form-control mt-4",attrs:{rows:"12",readonly:""},domProps:{value:t.empresa.descricaoAtividade},on:{input:function(a){a.target.composing||t.$set(t.empresa,"descricaoAtividade",a.target.value)}}})])],1)],1),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 mt-4"},[e("button",{staticClass:"btn btn-success",on:{click:function(a){return t.salvar()}}},[e("i",{staticClass:"fas fa-save"}),t._v("\n                                    Salvar")])])])],1)],1),t._v(" "),this.editar&&this.montou?e("b-tab",{attrs:{title:"Ambiente & Cargos"}},[e("b-card-text",[e("ppra-ambiente",{attrs:{ppra:this.ppra,empresa:this.empresadb}})],1)],1):t._e(),t._v(" "),e("b-tab",{attrs:{title:"Plano de Ação"}},[this.editar&&this.montou?e("b-card-text",[e("ppra-plano-acao",{attrs:{ppra:this.ppra}})],1):t._e()],1),t._v(" "),e("b-tab",{attrs:{title:"Histórico de Revisões"}},[this.editar&&this.montou?e("b-card-text",[e("ppra-historico-revisao",{attrs:{ppra:this.ppra}})],1):t._e()],1),t._v(" "),"NENHUM"!=t.empresadb.tipoEmpresa?e("b-tab",{attrs:{title:"Contrato"}},[this.editar&&this.montou?e("b-card-text",[e("ppra-capa",{attrs:{ppra:this.ppra}})],1):t._e()],1):t._e()],1)],1)],1)],1)}),[],!1,null,"960f0772",null);a.default=s.exports}}]);